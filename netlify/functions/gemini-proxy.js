const GEMINI_API_KEY=process.env.GEMINI_API_KEY||'';const GEMINI_API_URL='https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent';exports.handler=async(event)=>{const headers={'Access-Control-Allow-Origin':'*','Access-Control-Allow-Headers':'Content-Type','Access-Control-Allow-Methods':'POST,OPTIONS','Content-Type':'application/json'};if(event.httpMethod==='OPTIONS')return{statusCode:200,headers,body:''};if(event.httpMethod!=='POST')return{statusCode:405,headers,body:JSON.stringify({error:'Method not allowed'})};try{const{systemPrompt,userPrompt}=JSON.parse(event.body);if(!systemPrompt||!userPrompt)return{statusCode:400,headers,body:JSON.stringify({error:'缺少參數'})};const response=await fetch(\`\${GEMINI_API_URL}?key=\${GEMINI_API_KEY}\`,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({contents:[{parts:[{text:systemPrompt},{text:userPrompt}]}],generationConfig:{temperature:0.7,topK:40,topP:0.95,maxOutputTokens:8192}})});if(!response.ok)throw new Error(\`API error: \${response.status}\`);const data=await response.json();const text=data.candidates?.[0]?.content?.parts?.[0]?.text||'無回應';return{statusCode:200,headers,body:JSON.stringify({response:text})}}catch(error){return{statusCode:500,headers,body:JSON.stringify({error:'處理失敗',details:error.message})}}};
