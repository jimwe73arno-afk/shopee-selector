<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopee Analyst | BrotherG AI</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;800&family=JetBrains+Mono:wght@400;500;700&family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Rajdhani', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        aiBlue: '#00A0E9',
                        panel: '#F8FAFC',
                        border: '#E2E8F0',
                        textMain: '#0F172A',
                        textSub: '#64748B',
                        gold: '#D97706',
                    },
                    boxShadow: {
                        'neon': '0 0 15px rgba(0, 160, 233, 0.2)',
                        'card': '0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03)',
                        'card-hover': '0 20px 25px -5px rgba(0, 0, 0, 0.05), 0 10px 10px -5px rgba(0, 0, 0, 0.02)',
                        'glow-pro': '0 0 25px rgba(0, 160, 233, 0.25)',
                        'glow-master': '0 0 25px rgba(217, 119, 6, 0.25)',
                    },
                    animation: {
                        'shockwave': 'shockwave 0.6s ease-out',
                    },
                    keyframes: {
                        shockwave: {
                            '0%': { transform: 'translate(-50%, -50%) scale(0)', opacity: '0.5' },
                            '100%': { transform: 'translate(-50%, -50%) scale(3)', opacity: '0' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #FFFFFF; color: #0F172A; overflow: hidden; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 4px; background: #FFF; }
        ::-webkit-scrollbar-thumb { background: #E2E8F0; border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: #00A0E9; }

        /* Pure Background */
        .cosmos-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: 
                radial-gradient(circle at 10% 10%, rgba(0, 160, 233, 0.03) 0%, transparent 40%),
                radial-gradient(circle at 90% 90%, rgba(0, 160, 233, 0.03) 0%, transparent 40%);
            z-index: -1;
            pointer-events: none;
        }

        /* Core Card Design */
        .core-card {
            background: #FFFFFF;
            border: 1px solid #E2E8F0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        /* Inputs */
        .cyber-input {
            background: #FFFFFF;
            border: 1px solid #E2E8F0;
            color: #0F172A;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
        }
        .cyber-input:focus {
            border-color: #00A0E9;
            box-shadow: 0 0 0 4px rgba(0, 160, 233, 0.1);
            outline: none;
        }

        /* Custom file input style */
        .custom-file-upload {
            border: 2px dashed #CBD5E1;
            background-color: #F8FAFC;
            transition: all 0.3s;
        }
        .custom-file-upload:hover {
            border-color: #00A0E9;
            background-color: #F0F9FF;
        }

        /* Pricing Card Check/Cross */
        .feature-check { color: #00A0E9; margin-right: 0.5rem; }
        .feature-cross { color: #94A3B8; margin-right: 0.5rem; opacity: 0.5; }
        
        /* Plan Selection Transitions */
        .plan-card {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
        }
    </style>
</head>
<body class="h-screen flex overflow-hidden selection:bg-aiBlue selection:text-white">

    <div class="cosmos-bg"></div>

    <!-- Main View -->
    <main class="flex-1 relative overflow-hidden flex flex-col">
        
        <!-- Top HUD -->
        <header class="h-16 px-8 flex justify-between items-center z-20 border-b border-border bg-white/80 backdrop-blur-md">
            <div class="flex items-center space-x-4">
                <div class="h-2 w-2 bg-aiBlue rotate-45"></div>
                <span class="text-textMain font-display text-xl tracking-[0.1em] font-bold">BROTHER<span class="text-aiBlue">GAi</span></span>
            </div>
            <div class="flex items-center space-x-8 text-xs font-mono text-textSub">
                <div class="flex items-center space-x-2">
                    <span class="text-aiBlue animate-pulse">â—</span>
                    <span>SYSTEM READY</span>
                </div>
                <div class="border border-border px-3 py-1 rounded text-aiBlue bg-blue-50 font-bold">Shopee Analyst</div>
            </div>
        </header>

        <!-- Viewport -->
        <div class="flex-1 overflow-y-auto scroll-smooth p-8 md:p-16 flex flex-col">
            <!-- === SHOPEE INTERFACE === -->
            <div class="h-full flex flex-col max-w-7xl mx-auto w-full">
                <!-- Nav Bar -->
                <div class="flex items-center space-x-4 mb-10">
                    <button onclick="window.location.href='https://brotherg.ai'" class="w-10 h-10 border border-gray-300 flex items-center justify-center text-textSub hover:bg-blue-50 hover:text-aiBlue hover:border-aiBlue transition-all bg-white shadow-sm rounded-lg">
                        <i class="fa-solid fa-angle-left"></i>
                    </button>
                    <div class="h-px flex-1 bg-gradient-to-r from-aiBlue/50 to-transparent"></div>
                    <div class="font-mono text-xs text-aiBlue tracking-widest shadow-sm px-3 py-1 border border-aiBlue rounded bg-blue-50 font-bold">SHOPEE ANALYST</div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 h-full">
                    <!-- Left Control (Input and Mode Selection) -->
                    <div class="lg:col-span-4 space-y-6">
                        
                        <!-- Mode Tabs (Free / Paid) -->
                        <div class="flex border-b border-border bg-white rounded-t-xl overflow-hidden shadow-card">
                            <button id="tab-free" onclick="switchShopeeMode('free')" class="flex-1 py-3 text-sm font-bold transition-all border-b-2" data-mode="free">
                                <span class="text-aiBlue">å…è²»ç‰ˆ</span> <span class="text-xs text-textSub">(æ–‡å­—)</span>
                            </button>
                            <button id="tab-paid" onclick="switchShopeeMode('paid')" class="flex-1 py-3 text-sm font-bold transition-all border-b-2" data-mode="paid">
                                <span class="text-textSub">ä»˜è²»ç‰ˆ</span> <span class="text-xs text-textSub">(å ±è¡¨åœ–)</span>
                            </button>
                        </div>
                        
                        <!-- Input Card -->
                        <div class="core-card flex-col p-6 h-auto rounded-b-xl" style="display: flex; flex-direction: column;">
                            
                            <!-- === Free Mode Content === -->
                            <div id="shopee-input-free">
                                <div>
                                    <label class="text-xs font-bold text-aiBlue mb-2 block tracking-widest">WHAT ARE YOU SELLING? (è«‹æä¾›ç´°ç¯€)</label>
                                    <textarea id="shopee-keyword" rows="5" placeholder="ä¾‹å¦‚ï¼šæˆ‘åœ¨è¦çš®è³£ eSIMã€å°ç±³æ‰‹æ©Ÿã€Dysonï¼Œå¹«æˆ‘çœ‹æ¥ä¸‹ä¾†è¦ä¸»æ¨ä»€éº¼ã€‚ (å–®åƒ¹ã€æ¯›åˆ©ã€éŠ·é‡ç­‰è³‡è¨Šè¶Šè©³ç´°ï¼Œå»ºè­°è¶Šç²¾æº–)" 
                                        class="w-full cyber-input p-4 text-base rounded-lg placeholder-gray-400 resize-none border-l-4 border-l-aiBlue"></textarea>
                                    
                                    <button onclick="runShopeeAnalysis()" class="w-full mt-4 bg-textMain text-white font-display font-bold py-4 hover:bg-aiBlue transition-all duration-300 tracking-widest uppercase text-lg relative overflow-hidden shadow-lg rounded-lg">
                                        é–‹å§‹åˆ†æå¸‚å ´
                                    </button>
                                </div>
                            </div>
                            
                            <!-- === Paid Mode Content === -->
                            <div id="shopee-input-paid" class="hidden">
                                
                                <div class="mb-4">
                                    <div class="flex justify-between items-center mb-4">
                                        <label class="text-xs font-bold text-aiBlue mb-1 block tracking-widest">UPLOAD REPORTS (MAX 10)</label>
                                        <span class="font-mono text-[10px] text-green-500 border border-green-200 px-2 py-0.5 rounded bg-green-50 font-bold">å·²é–‹æ”¾</span>
                                    </div>
                                    
                                    <label for="shopee-image-upload" class="custom-file-upload p-6 flex flex-col items-center justify-center h-32 cursor-pointer rounded-lg mb-4">
                                        <i class="fa-solid fa-cloud-arrow-up text-3xl text-aiBlue mb-2"></i>
                                        <span class="text-sm font-medium text-textMain">é»æ“Šä¸Šå‚³ Shopee å ±è¡¨æˆªåœ–</span>
                                        <span class="text-xs text-gray-400 font-mono">æœ€å¤š 10 å¼µ (GMV, å»£å‘Š, å•†å“åˆ—è¡¨...)</span>
                                        <input type="file" id="shopee-image-upload" multiple accept="image/*" class="hidden">
                                    </label>
                                    
                                    <div id="image-preview" class="mb-4 grid grid-cols-2 gap-2"></div>

                                    <label class="text-xs font-bold text-aiBlue mb-2 block tracking-widest">YOUR QUERY</label>
                                    <textarea id="shopee-image-query" rows="2" placeholder="ä¾‹å¦‚ï¼šçœ‹å®Œåœ–ï¼Œæ¥ä¸‹ä¾† 7 å¤©æˆ‘è©²æ€éº¼é¸å“ï¼Ÿ" 
                                        class="w-full cyber-input p-3 text-base rounded-lg placeholder-gray-400 resize-none border-l-4 border-l-aiBlue"></textarea>
                                </div>

                                <button onclick="runShopeeImageAnalysis()" class="w-full mt-4 bg-textMain text-white font-display font-bold py-4 hover:bg-aiBlue transition-all duration-300 tracking-widest uppercase text-lg relative overflow-hidden shadow-lg rounded-lg">
                                    é–‹å§‹åœ–ç‰‡åˆ†æ
                                </button>
                                <p class="text-[10px] text-textSub mt-2 text-center font-mono">
                                    (ç›®å‰æ‰€æœ‰åŠŸèƒ½å·²é–‹æ”¾ï¼Œå¯ç›´æ¥ä½¿ç”¨)
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Right Data Vis (Dynamic Content) -->
                    <div class="lg:col-span-8 core-card flex-col p-8 relative rounded-xl overflow-y-auto" style="display: flex; flex-direction: column;">
                        
                        <!-- Loading -->
                        <div id="shopee-loading" class="hidden absolute inset-0 bg-white/90 z-20 flex flex-col items-center justify-center rounded-xl">
                            <div class="w-32 h-32 border-t-4 border-b-4 border-aiBlue rounded-full animate-spin mb-8 shadow-neon"></div>
                            <div class="text-4xl font-display font-bold text-textMain tracking-widest animate-pulse">ANALYZING</div>
                            <div class="text-xs font-mono text-aiBlue mt-4 border border-aiBlue px-4 py-1 font-bold rounded-full">FETCHING MARKET DATA</div>
                        </div>

                        <!-- Empty State -->
                        <div id="shopee-empty" class="flex-1 flex flex-col items-center justify-center opacity-40">
                            <i class="fa-solid fa-magnifying-glass-chart text-8xl mb-8 text-aiBlue animate-pulse"></i>
                            <p class="font-mono text-sm tracking-[0.3em] text-textSub font-bold">ç­‰å¾…é¸å“è¼¸å…¥</p>
                        </div>

                        <!-- Results (Free Version) -->
                        <div id="shopee-results" class="hidden h-full flex flex-col w-full">
                            
                            <!-- Header -->
                            <div class="mb-8 border-b border-gray-200 pb-4">
                                <h3 class="text-xl font-display font-bold text-textMain">é¸å“æ±ºç­–å¡</h3>
                                <p class="text-sm text-textSub">åŸºæ–¼æ‚¨çš„æ–‡å­—æè¿°ï¼Œä»¥ä¸‹æ˜¯ç³»çµ±å»ºè­°ã€‚</p>
                            </div>

                            <!-- Top 10 Core Recommendations -->
                            <div class="mb-8 p-6 bg-blue-50 border border-aiBlue/30 rounded-lg">
                                <p class="text-[10px] text-aiBlue font-bold uppercase mb-4 tracking-widest flex items-center">
                                    <i class="fa-solid fa-star-of-life mr-2"></i> TOP 10 ä¸»æ¨æ–¹å‘ (æ ¸å¿ƒå»ºè­°)
                                </p>
                                <ul id="top-10-list" class="space-y-3">
                                    <!-- List items populated by JS -->
                                </ul>
                            </div>

                            <!-- Extended Ideas -->
                            <div class="mb-8 p-6 bg-panel border border-border rounded-lg">
                                <p class="text-[10px] text-textSub font-bold uppercase mb-4 tracking-widest flex items-center">
                                    <i class="fa-solid fa-atom mr-2"></i> å»¶ä¼¸æ¸¬è©¦çµ„åˆ/é¡åˆ¥
                                </p>
                                <p id="extended-ideas" class="text-sm text-textSub leading-relaxed">
                                    <!-- Populated by API response -->
                                </p>
                            </div>
                        </div>
                        
                        <!-- Pricing Table (Paid Mode) -->
                        <div id="shopee-paid-results" class="hidden h-full flex flex-col w-full">
                            <div class="mb-6 flex justify-between items-end border-b border-border pb-4">
                                <div>
                                    <h3 class="text-2xl font-display font-bold text-textMain tracking-wide">CHOOSE YOUR PLAN</h3>
                                    <p class="text-xs font-mono text-textSub mt-1">è§£é– AI è¦–è¦ºæ·±åº¦è¨ºæ–·èˆ‡æ‰¹é‡åˆ†æèƒ½åŠ›</p>
                                </div>
                                <div class="text-[10px] font-bold bg-blue-50 text-aiBlue px-2 py-1 rounded border border-blue-100">
                                    æ¯æœˆè¨‚é–±åˆ¶
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 flex-1 items-start">
                                
                                <!-- Tier 1: Free -->
                                <div id="plan-card-free" onclick="selectPlan('free')" class="plan-card border border-border rounded-xl p-6 flex flex-col relative bg-white opacity-90">
                                    <h4 class="text-sm font-bold text-textSub uppercase tracking-widest mb-2">é«”é©—ç‰ˆ</h4>
                                    <div class="mb-4">
                                        <span class="text-3xl font-display font-bold text-textMain">$0</span>
                                        <span class="text-xs text-textSub">/ month</span>
                                    </div>
                                    <p class="text-xs text-textSub mb-6 h-10">é©åˆå‰›å…¥é–€çš„æ–°æ‰‹ï¼Œé«”é©— AI å¨åŠ›ã€‚</p>
                                    
                                    <ul class="space-y-3 text-xs mb-8 flex-1">
                                        <li class="flex items-center"><i class="fa-solid fa-check feature-check"></i> æ¯æ—¥ 5 æ¬¡ AI å°è©±</li>
                                        <li class="flex items-center"><i class="fa-solid fa-check feature-check"></i> å–®æ¬¡å°è©± (ç„¡è¨˜æ†¶)</li>
                                        <li class="flex items-center text-gray-400"><i class="fa-solid fa-xmark feature-cross"></i> AI è¦–è¦ºè¨ºæ–·</li>
                                        <li class="flex items-center text-gray-400"><i class="fa-solid fa-xmark feature-cross"></i> æ‰¹é‡åˆ†æ</li>
                                    </ul>

                                    <button class="w-full py-2 border border-border text-textSub font-bold text-xs rounded pointer-events-none">
                                        ç›®å‰æ–¹æ¡ˆ
                                    </button>
                                </div>

                                <!-- Tier 2: PRO -->
                                <div id="plan-card-pro" onclick="selectPlan('pro')" class="plan-card border border-border rounded-xl p-6 flex flex-col relative bg-white opacity-90">
                                    <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-aiBlue text-white text-[10px] font-bold px-3 py-1 rounded-full tracking-wider shadow-sm opacity-0 transition-opacity duration-300" id="badge-pro">
                                        å€‹äººè³£å®¶é¦–é¸
                                    </div>
                                    <h4 class="text-sm font-bold text-textSub uppercase tracking-widest mb-2 transition-colors duration-300" id="title-pro">å°ˆæ¥­ç‰ˆ</h4>
                                    <div class="mb-4">
                                        <span class="text-3xl font-display font-bold text-textMain">$688</span>
                                        <span class="text-xs text-textSub">/ month</span>
                                    </div>
                                    <p class="text-xs text-textSub mb-6 h-10">é©åˆå…¨è·è³£å®¶ï¼Œæ·±åº¦å„ªåŒ–åˆ©æ½¤ã€‚</p>
                                    
                                    <ul class="space-y-3 text-xs mb-8 flex-1 font-medium">
                                        <li class="flex items-center"><i class="fa-solid fa-check feature-check"></i> ç„¡é™æ¬¡ AI å°è©±</li>
                                        <li class="flex items-center"><i class="fa-solid fa-check feature-check"></i> æ¯æ—¥ 20 æ¬¡ è¦–è¦ºè¨ºæ–·</li>
                                        <li class="flex items-center"><i class="fa-solid fa-check feature-check"></i> å–®å¼µåœ–ç‰‡ä¸Šå‚³</li>
                                        <li class="flex items-center text-red-400"><i class="fa-solid fa-xmark feature-cross"></i> ç„¡é•·æœŸè¨˜æ†¶ (å°è©±ç¨ç«‹)</li>
                                        <li class="flex items-center"><i class="fa-solid fa-check feature-check"></i> ç«¶å“æ•¸æ“šåˆ†æ</li>
                                    </ul>

                                    <button onclick="event.stopPropagation(); goToPaymentPro()" class="w-full py-3 bg-gray-200 text-gray-500 font-bold text-sm rounded shadow-sm hover:bg-aiBlue hover:text-white transition-colors duration-300" id="btn-pro">
                                        ç«‹å³å‡ç´š PRO
                                    </button>
                                </div>

                                <!-- Tier 3: MASTER -->
                                <div id="plan-card-master" onclick="selectPlan('master')" class="plan-card border border-border rounded-xl p-6 flex flex-col relative bg-white opacity-90">
                                    <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-gradient-to-r from-yellow-500 to-amber-600 text-white text-[10px] font-bold px-3 py-1 rounded-full tracking-wider shadow-sm opacity-0 transition-opacity duration-300" id="badge-master">
                                        å·¥ä½œå®¤/ä¼æ¥­å°ˆç”¨
                                    </div>
                                    <h4 class="text-sm font-bold text-textSub uppercase tracking-widest mb-2 transition-colors duration-300" id="title-master">å¤§å¸«ç‰ˆ</h4>
                                    <div class="mb-4">
                                        <span class="text-3xl font-display font-bold text-textMain">$1,688</span>
                                        <span class="text-xs text-textSub">/ month</span>
                                    </div>
                                    <p class="text-xs text-textSub mb-6 h-10">é©åˆå·¥ä½œå®¤èˆ‡å¤šå¹³å°ç¶“ç‡Ÿè€…ï¼Œæ¥µè‡´æ•ˆç‡ã€‚</p>
                                    
                                    <ul class="space-y-3 text-xs mb-8 flex-1">
                                        <li class="flex items-center"><i class="fa-solid fa-check text-amber-500 mr-2"></i> ç„¡é™æ¬¡ AI å°è©±</li>
                                        <li class="flex items-center"><i class="fa-solid fa-check text-amber-500 mr-2"></i> æ¯æ—¥ 50 æ¬¡ è¦–è¦ºè¨ºæ–·</li>
                                        <li class="flex items-center"><i class="fa-solid fa-fire text-amber-500 mr-2"></i> æ‰¹é‡ä¸Šå‚³ (ä¸€æ¬¡ 10 å¼µ)</li>
                                        <li class="flex items-center"><i class="fa-solid fa-brain text-amber-500 mr-2"></i> AI é•·æœŸè¨˜æ†¶ (åº—é‹ªèªå¢ƒ)</li>
                                        <li class="flex items-center"><i class="fa-solid fa-bolt text-amber-500 mr-2"></i> å„ªå…ˆç®—åŠ›é€šé“</li>
                                    </ul>

                                    <button onclick="event.stopPropagation(); goToPaymentMaster()" class="w-full py-2 border border-border text-textSub font-bold text-xs rounded hover:bg-amber-50 hover:text-amber-600 hover:border-amber-500 transition-colors duration-300" id="btn-master">
                                        æˆç‚ºå¤§å¸«
                                    </button>
                                </div>

                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-8 right-8 bg-textMain text-white px-6 py-3 rounded-lg shadow-xl transform translate-y-24 opacity-0 transition-all duration-300 z-50 flex items-center gap-3">
        <i class="fa-solid fa-info-circle text-aiBlue"></i>
        <span id="toast-msg" class="font-medium text-sm">Notification</span>
    </div>

    <script>
        // State for Shopee Mode
        let shopeeMode = 'free';
        let currentPlan = null;

        // --- Toast Logic ---
        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            toast.classList.remove('translate-y-24', 'opacity-0');
            setTimeout(() => {
                toast.classList.add('translate-y-24', 'opacity-0');
            }, 3000);
        }
        
        // --- Shopee Mode Switch Logic ---
        function switchShopeeMode(mode) {
            shopeeMode = mode;
            const tabFree = document.getElementById('tab-free');
            const tabPaid = document.getElementById('tab-paid');
            const inputFree = document.getElementById('shopee-input-free');
            const inputPaid = document.getElementById('shopee-input-paid');
            const resultsDiv = document.getElementById('shopee-results');
            const paidResultsDiv = document.getElementById('shopee-paid-results');
            
            if (mode === 'free') {
                tabFree.classList.add('border-aiBlue', 'text-aiBlue');
                tabPaid.classList.remove('border-aiBlue', 'text-aiBlue');
                tabPaid.classList.add('border-transparent');

                inputFree.classList.remove('hidden');
                inputPaid.classList.add('hidden');

                resultsDiv.classList.remove('hidden');
                paidResultsDiv.classList.add('hidden');
                
                // Reset result view to empty state
                document.getElementById('shopee-results').classList.add('hidden');
                document.getElementById('shopee-empty').classList.remove('hidden');

                showToast('å·²åˆ‡æ›è‡³å…è²»ç‰ˆ (æ–‡å­—åˆ†æ)');

            } else { // paid
                tabPaid.classList.add('border-aiBlue', 'text-aiBlue');
                tabFree.classList.remove('border-aiBlue', 'text-aiBlue');
                tabFree.classList.add('border-transparent');

                inputPaid.classList.remove('hidden');
                inputFree.classList.add('hidden');

                resultsDiv.classList.add('hidden');
                paidResultsDiv.classList.remove('hidden');

                document.getElementById('shopee-empty').classList.add('hidden');
                
                // Reset Plans on Switch
                resetPlans();
                
                showToast('ä»˜è²»ç‰ˆï¼šè«‹é¸æ“‡é©åˆæ‚¨çš„æ–¹æ¡ˆ');
            }
        }
        
        // --- Plan Selection Logic ---
        function resetPlans() {
            currentPlan = null;
            const plans = ['free', 'pro', 'master'];
            
            plans.forEach(plan => {
                const card = document.getElementById(`plan-card-${plan}`);
                
                // Reset Base Styles
                card.classList.remove('scale-105', 'z-10', 'opacity-100', 'border-aiBlue', 'shadow-glow-pro', 'border-yellow-500', 'shadow-glow-master');
                card.classList.add('scale-100', 'z-0', 'opacity-90', 'border-border');
                
                // Reset Text Colors
                if(plan === 'pro') {
                    document.getElementById('title-pro').classList.remove('text-aiBlue');
                    document.getElementById('title-pro').classList.add('text-textSub');
                    document.getElementById('badge-pro').classList.remove('opacity-100');
                    document.getElementById('badge-pro').classList.add('opacity-0');
                    
                    const btn = document.getElementById('btn-pro');
                    btn.classList.remove('bg-aiBlue', 'text-white');
                    btn.classList.add('bg-gray-200', 'text-gray-500');
                }
                
                if(plan === 'master') {
                    document.getElementById('title-master').classList.remove('text-amber-600');
                    document.getElementById('title-master').classList.add('text-textSub');
                    document.getElementById('badge-master').classList.remove('opacity-100');
                    document.getElementById('badge-master').classList.add('opacity-0');
                    
                    const btn = document.getElementById('btn-master');
                    btn.classList.remove('border-amber-500', 'text-amber-600');
                    btn.classList.add('border-border', 'text-textSub');
                }
            });
        }

        function selectPlan(plan) {
            if (currentPlan === plan) return;
            
            resetPlans();
            currentPlan = plan;
            
            const card = document.getElementById(`plan-card-${plan}`);
            
            // Apply Active Styles
            card.classList.remove('scale-100', 'z-0', 'opacity-90', 'border-border');
            card.classList.add('scale-105', 'z-10', 'opacity-100');
            
            if (plan === 'free') {
                 card.classList.add('border-gray-400', 'shadow-lg');
            } else if (plan === 'pro') {
                card.classList.add('border-aiBlue', 'shadow-glow-pro');
                
                document.getElementById('title-pro').classList.remove('text-textSub');
                document.getElementById('title-pro').classList.add('text-aiBlue');
                document.getElementById('badge-pro').classList.remove('opacity-0');
                document.getElementById('badge-pro').classList.add('opacity-100');
                
                const btn = document.getElementById('btn-pro');
                btn.classList.remove('bg-gray-200', 'text-gray-500');
                btn.classList.add('bg-aiBlue', 'text-white');
            } else if (plan === 'master') {
                card.classList.add('border-yellow-500', 'shadow-glow-master');
                
                document.getElementById('title-master').classList.remove('text-textSub');
                document.getElementById('title-master').classList.add('text-amber-600');
                document.getElementById('badge-master').classList.remove('opacity-0');
                document.getElementById('badge-master').classList.add('opacity-100');
                
                const btn = document.getElementById('btn-master');
                btn.classList.remove('border-border', 'text-textSub');
                btn.classList.add('border-amber-500', 'text-amber-600');
            }
        }

        // --- Payment Logic ---
        async function goToPaymentPro() {
            showToast('æ­£åœ¨æº–å‚™ PRO æ–¹æ¡ˆä»˜æ¬¾...');
            
            try {
                // ç²å–ç”¨æˆ¶ IDï¼ˆå¦‚æœæœ‰ç™»å…¥ç³»çµ±ï¼Œé€™è£¡æ‡‰è©²å¾ localStorage æˆ– cookie å–å¾—ï¼‰
                const userId = localStorage.getItem('userId') || 'anonymous';
                
                // èª¿ç”¨æ”¯ä»˜ API
                const response = await fetch('/.netlify/functions/payment-checkout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        plan: 'PRO',
                        userId: userId,
                    }),
                });

                if (!response.ok) {
                    throw new Error('ä»˜æ¬¾è«‹æ±‚å¤±æ•—');
                }

                // å–å¾—ä»˜æ¬¾è¡¨å–® HTMLï¼Œä¸¦åœ¨ç•¶å‰è¦–çª—æ‰“é–‹
                const html = await response.text();
                const newWindow = window.open('', '_blank');
                newWindow.document.write(html);
                newWindow.document.close();
                
            } catch (error) {
                console.error('ä»˜æ¬¾éŒ¯èª¤:', error);
                showToast('ä»˜æ¬¾è«‹æ±‚å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
            }
        }

        async function goToPaymentMaster() {
            showToast('æ­£åœ¨æº–å‚™å¤§å¸«ç‰ˆä»˜æ¬¾...');
            
            try {
                // ç²å–ç”¨æˆ¶ IDï¼ˆå¦‚æœæœ‰ç™»å…¥ç³»çµ±ï¼Œé€™è£¡æ‡‰è©²å¾ localStorage æˆ– cookie å–å¾—ï¼‰
                const userId = localStorage.getItem('userId') || 'anonymous';
                
                // èª¿ç”¨æ”¯ä»˜ API
                const response = await fetch('/.netlify/functions/payment-checkout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        plan: 'MASTER',
                        userId: userId,
                    }),
                });

                if (!response.ok) {
                    throw new Error('ä»˜æ¬¾è«‹æ±‚å¤±æ•—');
                }

                // å–å¾—ä»˜æ¬¾è¡¨å–® HTMLï¼Œä¸¦åœ¨ç•¶å‰è¦–çª—æ‰“é–‹
                const html = await response.text();
                const newWindow = window.open('', '_blank');
                newWindow.document.write(html);
                newWindow.document.close();
                
            } catch (error) {
                console.error('ä»˜æ¬¾éŒ¯èª¤:', error);
                showToast('ä»˜æ¬¾è«‹æ±‚å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦');
            }
        }

        // --- Shopee Analysis API Call ---
        async function runShopeeAnalysis() {
            if (shopeeMode !== 'free') return showToast('è«‹åˆ‡æ›è‡³å…è²»ç‰ˆä½¿ç”¨æ–‡å­—åˆ†æ');
            
            const keyword = document.getElementById('shopee-keyword').value;
            if(!keyword.trim()) return showToast('è«‹è¼¸å…¥æ‚¨çš„ç”¢å“æ¸…å–®æˆ–éœ€æ±‚');

            // Show loading
            document.getElementById('shopee-empty').classList.add('hidden');
            document.getElementById('shopee-results').classList.add('hidden');
            document.getElementById('shopee-loading').classList.remove('hidden');

            showToast('é–‹å§‹é€²è¡Œé¸å“åˆ†æ...');

            try {
                // Call backend API
                const response = await fetch('/.netlify/functions/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        textPrompt: keyword,
                        images: []
                    })
                });

                if (!response.ok) {
                    throw new Error(`API éŒ¯èª¤: ${response.status}`);
                }

                const data = await response.json();
                
                // æ·»åŠ è°ƒè¯•æ—¥å¿—
                console.log('ğŸ“¥ API éŸ¿æ‡‰æ•¸æ“š:', data);

                // æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯
                if (data.error) {
                    throw new Error(data.error || 'åˆ†æå¤±æ•—');
                }

                // æ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆæ•°æ®ï¼ˆæ›´å®½æ¾çš„æ£€æŸ¥ï¼‰
                const hasData = data.summary || data.recommendations || data.plan || data.reasoningText;
                if (!hasData) {
                    console.warn('âš ï¸ API è¿”å›çš„æ•¸æ“šæ ¼å¼ç•°å¸¸:', data);
                    // å³ä½¿æ²¡æœ‰æ ‡å‡†æ ¼å¼ï¼Œä¹Ÿå°è¯•æ˜¾ç¤ºåŸå§‹æ•°æ®
                    if (typeof data === 'string') {
                        data = { summary: data };
                    } else if (Object.keys(data).length === 0) {
                        throw new Error('API è¿”å›ç©ºæ•°æ®ï¼Œè¯·ç¨åé‡è¯•');
                    }
                }

                // Hide loading
                document.getElementById('shopee-loading').classList.add('hidden');

                // Parse and display results
                let recommendations = [];
                let extendedIdeas = '';
                let summaryText = '';

                // æå–æ‘˜è¦
                summaryText = data.summary || data.reasoningText || JSON.stringify(data).substring(0, 500);

                // æå–æ¨è–¦
                if (data.recommendations && Array.isArray(data.recommendations)) {
                    recommendations = data.recommendations;
                } else if (summaryText) {
                    // å¦‚æœæ²¡æœ‰æ¨è–¦ï¼Œä»æ‘˜è¦ä¸­ç”Ÿæˆ
                    recommendations = [
                        { item: "æ ¸å¿ƒåˆ†æ", reason: summaryText.substring(0, 200) }
                    ];
                }

                // æå–è¨ˆåŠƒ
                if (data.plan) {
                    extendedIdeas = data.plan;
                } else if (summaryText) {
                    extendedIdeas = summaryText;
                } else {
                    extendedIdeas = 'æš«ç„¡å»¶ä¼¸å»ºè­°ï¼Œè«‹æŸ¥çœ‹ä¸Šæ–¹åˆ†æçµæœã€‚';
                }
                
                console.log('ğŸ“Š è§£æå¾Œçš„æ•¸æ“š:', { recommendations, extendedIdeas, summaryText });

                // Populate Top 10 List
                const top10List = document.getElementById('top-10-list');
                if (!top10List) {
                    console.error('âŒ æ‰¾ä¸åˆ° top-10-list å…ƒç´ ');
                } else {
                    top10List.innerHTML = '';
                    
                    // å¦‚æœæ²¡æœ‰æ¨èï¼Œè‡³å°‘æ˜¾ç¤ºæ‘˜è¦
                    if (recommendations.length === 0 && summaryText) {
                        // å°†æ‘˜è¦åˆ†æ®µæ˜¾ç¤º
                        const summaryParts = summaryText.split(/[ã€‚ï¼\n]/).filter(p => p.trim()).slice(0, 10);
                        if (summaryParts.length === 0) {
                            // å¦‚æœåˆ†å‰²åæ²¡æœ‰å†…å®¹ï¼Œç›´æ¥æ˜¾ç¤ºå®Œæ•´æ‘˜è¦
                            summaryParts.push(summaryText);
                        }
                        summaryParts.forEach((part, index) => {
                            top10List.innerHTML += `
                                <li class="flex items-start text-sm border-b border-blue-100 pb-2">
                                    <span class="font-mono font-bold text-aiBlue w-6 flex-shrink-0">#${index + 1}</span>
                                    <div>
                                        <span class="text-textSub">${part.trim()}${part.endsWith('ã€‚') ? '' : 'ã€‚'}</span>
                                    </div>
                                </li>
                            `;
                        });
                    } else {
                        recommendations.slice(0, 10).forEach((rec, index) => {
                            const item = typeof rec === 'string' ? rec : (rec.item || rec || `å»ºè­° ${index + 1}`);
                            const reason = typeof rec === 'string' ? '' : (rec.reason || '');
                            
                            top10List.innerHTML += `
                                <li class="flex items-start text-sm border-b border-blue-100 pb-2">
                                    <span class="font-mono font-bold text-aiBlue w-6 flex-shrink-0">#${index + 1}</span>
                                    <div>
                                        <span class="font-bold text-textMain">${item}</span>
                                        ${reason ? `<span class="text-textSub">: ${reason}</span>` : ''}
                                    </div>
                                </li>
                            `;
                        });
                    }
                }
                
                console.log('âœ… Top 10 List å·²å¡«å……ï¼Œå…±', recommendations.length || 0, 'é …');

                // Populate extended ideas
                const extendedIdeasText = extendedIdeas || summaryText || 'æš«ç„¡å»¶ä¼¸å»ºè­°';
                const extendedIdeasEl = document.getElementById('extended-ideas');
                if (extendedIdeasEl) {
                    extendedIdeasEl.innerText = extendedIdeasText || 'æš«ç„¡å»¶ä¼¸å»ºè­°';
                }

                // ç¢ºä¿éš±è—ç©ºç‹€æ…‹å’Œé¡¯ç¤ºçµæœ
                const emptyEl = document.getElementById('shopee-empty');
                const resultsEl = document.getElementById('shopee-results');
                
                if (emptyEl) emptyEl.classList.add('hidden');
                if (resultsEl) {
                    resultsEl.classList.remove('hidden');
                    console.log('âœ… é¡¯ç¤ºçµæœå€åŸŸ');
                } else {
                    console.error('âŒ æ‰¾ä¸åˆ° shopee-results å…ƒç´ ');
                }
                
                // æ¸…ç©ºè¼¸å…¥æ¡†
                const keywordEl = document.getElementById('shopee-keyword');
                if (keywordEl) keywordEl.value = '';
                
                showToast('é¸å“æ±ºç­–å¡å·²æˆåŠŸç”Ÿæˆï¼');
                console.log('âœ… åˆ†æå®Œæˆä¸¦é¡¯ç¤ºçµæœ');

            } catch (error) {
                console.error('åˆ†æéŒ¯èª¤:', error);
                document.getElementById('shopee-loading').classList.add('hidden');
                document.getElementById('shopee-results').classList.add('hidden');
                document.getElementById('shopee-empty').classList.remove('hidden');
                
                // æ˜¾ç¤ºæ›´è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
                const errorMsg = error.message || 'æœªçŸ¥éŒ¯èª¤';
                showToast('åˆ†æå¤±æ•—: ' + errorMsg);
                
                // åœ¨æ§åˆ¶å°æ˜¾ç¤ºå®Œæ•´é”™è¯¯
                console.error('å®Œæ•´éŒ¯èª¤ä¿¡æ¯:', {
                    message: error.message,
                    stack: error.stack,
                    error: error
                });
            }
        }

        // --- Image Upload Handler ---
        let uploadedImages = [];
        
        document.addEventListener('DOMContentLoaded', function() {
            const imageUpload = document.getElementById('shopee-image-upload');
            if (imageUpload) {
                imageUpload.addEventListener('change', function(e) {
                    uploadedImages = [];
                    const files = Array.from(e.target.files).slice(0, 10);
                    const preview = document.getElementById('image-preview');
                    if (preview) preview.innerHTML = '';
                    
                    console.log('ğŸ“· [åœ–ç‰‡ä¸Šå‚³] é¸æ“‡äº†', files.length, 'å¼µåœ–ç‰‡');
                    
                    if (files.length === 0) {
                        showToast('è«‹é¸æ“‡è‡³å°‘ä¸€å¼µåœ–ç‰‡');
                        return;
                    }
                    
                    let loadedCount = 0;
                    files.forEach((file, index) => {
                        const reader = new FileReader();
                        reader.onload = function(e) {
                            uploadedImages.push(e.target.result);
                            loadedCount++;
                            console.log(`âœ… [åœ–ç‰‡ä¸Šå‚³] åœ–ç‰‡ ${index + 1}/${files.length} å·²è¼‰å…¥`);
                            
                            // Show preview
                            if (preview) {
                                const imgWrapper = document.createElement('div');
                                imgWrapper.className = 'relative';
                                
                                const img = document.createElement('img');
                                img.src = e.target.result;
                                img.className = 'w-full h-20 object-cover rounded border border-border';
                                img.alt = `é è¦½ ${index + 1}`;
                                
                                const removeBtn = document.createElement('button');
                                removeBtn.innerHTML = 'Ã—';
                                removeBtn.className = 'absolute top-0 right-0 bg-red-500 text-white w-6 h-6 rounded-full text-xs hover:bg-red-600';
                                removeBtn.onclick = function() {
                                    uploadedImages.splice(index, 1);
                                    imgWrapper.remove();
                                    showToast(`å·²ç§»é™¤åœ–ç‰‡ ${index + 1}`);
                                };
                                
                                imgWrapper.appendChild(img);
                                imgWrapper.appendChild(removeBtn);
                                preview.appendChild(imgWrapper);
                            }
                            
                            if (loadedCount === files.length) {
                                console.log('âœ… [åœ–ç‰‡ä¸Šå‚³] æ‰€æœ‰åœ–ç‰‡å·²è¼‰å…¥ï¼Œå…±', uploadedImages.length, 'å¼µ');
                                showToast(`å·²è¼‰å…¥ ${uploadedImages.length} å¼µåœ–ç‰‡ï¼Œå¯ä»¥é–‹å§‹åˆ†æäº†`);
                            }
                        };
                        reader.onerror = function(error) {
                            console.error(`âŒ [åœ–ç‰‡ä¸Šå‚³] åœ–ç‰‡ ${index + 1} è¼‰å…¥å¤±æ•—:`, error);
                            showToast(`åœ–ç‰‡ ${index + 1} è¼‰å…¥å¤±æ•—`);
                        };
                        reader.readAsDataURL(file);
                    });
                });
            } else {
                console.warn('âš ï¸ [åœ–ç‰‡ä¸Šå‚³] æ‰¾ä¸åˆ° shopee-image-upload å…ƒç´ ');
            }
        });

        // --- Image Analysis Function ---
        async function runShopeeImageAnalysis() {
            console.log('ğŸš€ [åœ–ç‰‡åˆ†æ] é–‹å§‹åˆ†æï¼Œå·²ä¸Šå‚³åœ–ç‰‡æ•¸:', uploadedImages.length);
            
            if (uploadedImages.length === 0) {
                // å˜—è©¦å¾ input ç›´æ¥è®€å–æ–‡ä»¶
                const imageInput = document.getElementById('shopee-image-upload');
                if (imageInput && imageInput.files && imageInput.files.length > 0) {
                    console.log('âš ï¸ [åœ–ç‰‡åˆ†æ] uploadedImages ç‚ºç©ºï¼Œå¾ input é‡æ–°è®€å–æ–‡ä»¶');
                    const files = Array.from(imageInput.files);
                    const promises = files.map(file => {
                        return new Promise((resolve, reject) => {
                            const reader = new FileReader();
                            reader.onload = e => resolve(e.target.result);
                            reader.onerror = reject;
                            reader.readAsDataURL(file);
                        });
                    });
                    uploadedImages = await Promise.all(promises);
                    console.log('âœ… [åœ–ç‰‡åˆ†æ] å¾ input é‡æ–°è¼‰å…¥äº†', uploadedImages.length, 'å¼µåœ–ç‰‡');
                } else {
                    return showToast('è«‹å…ˆä¸Šå‚³åœ–ç‰‡');
                }
            }
            
            const query = document.getElementById('shopee-image-query')?.value || 'åˆ†æé€™äº›åœ–ç‰‡ä¸¦çµ¦å‡ºé¸å“å»ºè­°';
            console.log('ğŸ“ [åœ–ç‰‡åˆ†æ] æŸ¥è©¢æ–‡æœ¬:', query);
            console.log('ğŸ“· [åœ–ç‰‡åˆ†æ] æº–å‚™ç™¼é€', uploadedImages.length, 'å¼µåœ–ç‰‡');
            
            // Show loading
            document.getElementById('shopee-empty').classList.add('hidden');
            document.getElementById('shopee-results').classList.add('hidden');
            document.getElementById('shopee-paid-results').classList.add('hidden');
            document.getElementById('shopee-loading').classList.remove('hidden');
            
            showToast('é–‹å§‹é€²è¡Œåœ–ç‰‡åˆ†æ...');
            
            try {
                // Convert images to base64 array
                const base64Images = uploadedImages.map(img => {
                    // Remove data:image/xxx;base64, prefix if exists
                    return img.includes(',') ? img.split(',')[1] : img;
                });
                
                console.log('ğŸ“¤ [åœ–ç‰‡åˆ†æ] ç™¼é€ API è«‹æ±‚...');
                
                const response = await fetch('/.netlify/functions/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        textPrompt: query,
                        images: base64Images
                    })
                });
                
                console.log('ğŸ“¥ [åœ–ç‰‡åˆ†æ] API éŸ¿æ‡‰ç‹€æ…‹:', response.status, response.statusText);
                
                if (!response.ok) {
                    throw new Error(`API éŒ¯èª¤: ${response.status}`);
                }
                
                const data = await response.json();
                
                // æ·»åŠ è¯¦ç»†è°ƒè¯•æ—¥å¿—
                console.log('ğŸ“¥ [åœ–ç‰‡åˆ†æ] API éŸ¿æ‡‰æ•¸æ“š:', data);
                console.log('ğŸ“Š [åœ–ç‰‡åˆ†æ] æ•¸æ“šçµæ§‹:', {
                    hasSummary: !!data.summary,
                    hasRecommendations: !!data.recommendations,
                    hasPlan: !!data.plan,
                    recommendationsType: Array.isArray(data.recommendations) ? 'array' : typeof data.recommendations,
                    recommendationsLength: Array.isArray(data.recommendations) ? data.recommendations.length : 0
                });
                
                if (data.error) {
                    throw new Error(data.error || 'åˆ†æå¤±æ•—');
                }
                
                // Hide loading
                const loadingEl = document.getElementById('shopee-loading');
                if (loadingEl) loadingEl.classList.add('hidden');
                
                // Parse data with better fallback handling
                let recommendations = [];
                let extendedIdeas = '';
                let summaryText = '';
                
                // æå–æ‘˜è¦
                summaryText = data.summary || data.reasoningText || '';
                console.log('ğŸ“ [åœ–ç‰‡åˆ†æ] æ‘˜è¦é•·åº¦:', summaryText.length);
                
                // æå–æ¨è–¦ - æ›´å¥å£¯çš„è§£æ
                if (data.recommendations && Array.isArray(data.recommendations)) {
                    recommendations = data.recommendations;
                    console.log('âœ… [åœ–ç‰‡åˆ†æ] æ¨è–¦åˆ—è¡¨ (æ•¸çµ„):', recommendations.length, 'é …');
                } else if (typeof data.recommendations === 'string') {
                    // å¦‚æœæ˜¯å­—ç¬¦ä¸²ï¼Œå˜—è©¦åˆ†å‰²
                    recommendations = data.recommendations.split('\n').filter(r => r.trim()).map(r => ({ item: r.trim() }));
                    console.log('âš ï¸ [åœ–ç‰‡åˆ†æ] æ¨è–¦æ˜¯å­—ç¬¦ä¸²ï¼Œå·²è½‰æ›ç‚ºæ•¸çµ„');
                } else if (summaryText) {
                    // å¾æ‘˜è¦ç”Ÿæˆæ¨è–¦
                    const summaryParts = summaryText.split(/[ã€‚ï¼\n]/).filter(p => p.trim()).slice(0, 10);
                    recommendations = summaryParts.map((part, idx) => ({
                        item: `å»ºè­° ${idx + 1}`,
                        reason: part.trim()
                    }));
                    console.log('âš ï¸ [åœ–ç‰‡åˆ†æ] å¾æ‘˜è¦ç”Ÿæˆæ¨è–¦:', recommendations.length, 'é …');
                }
                
                // æå–è¨ˆåŠƒ
                if (data.plan) {
                    extendedIdeas = data.plan;
                } else if (summaryText) {
                    extendedIdeas = summaryText;
                } else {
                    extendedIdeas = 'æš«ç„¡å»¶ä¼¸å»ºè­°ï¼Œè«‹æŸ¥çœ‹ä¸Šæ–¹åˆ†æçµæœã€‚';
                }
                
                console.log('ğŸ“Š [åœ–ç‰‡åˆ†æ] è§£æå¾Œçš„æ•¸æ“š:', {
                    recommendations: recommendations.length,
                    extendedIdeasLength: extendedIdeas.length,
                    summaryLength: summaryText.length
                });
                
                // Populate Top 10 List
                const top10List = document.getElementById('top-10-list');
                if (!top10List) {
                    console.error('âŒ [åœ–ç‰‡åˆ†æ] æ‰¾ä¸åˆ° top-10-list å…ƒç´ ');
                } else {
                    top10List.innerHTML = '';
                    
                    // å¦‚æœæ²’æœ‰æ¨è–¦ï¼Œå¾æ‘˜è¦ç”Ÿæˆåˆ—è¡¨
                    if (recommendations.length === 0 && summaryText) {
                        console.log('âš ï¸ [åœ–ç‰‡åˆ†æ] æ²’æœ‰æ¨è–¦åˆ—è¡¨ï¼Œå¾æ‘˜è¦ç”Ÿæˆ');
                        const summaryParts = summaryText.split(/[ã€‚ï¼\n]/).filter(p => p.trim()).slice(0, 10);
                        if (summaryParts.length === 0) {
                            summaryParts.push(summaryText.substring(0, 200));
                        }
                        summaryParts.forEach((part, index) => {
                            top10List.innerHTML += `
                                <li class="flex items-start text-sm border-b border-blue-100 pb-2">
                                    <span class="font-mono font-bold text-aiBlue w-6 flex-shrink-0">#${index + 1}</span>
                                    <div>
                                        <span class="text-textSub">${part.trim()}${part.endsWith('ã€‚') ? '' : 'ã€‚'}</span>
                                    </div>
                                </li>
                            `;
                        });
                    } else {
                        // é¡¯ç¤ºæ¨è–¦åˆ—è¡¨
                        recommendations.slice(0, 10).forEach((rec, index) => {
                            const item = typeof rec === 'string' ? rec : (rec.item || rec || `å»ºè­° ${index + 1}`);
                            const reason = typeof rec === 'string' ? '' : (rec.reason || '');
                            
                            top10List.innerHTML += `
                                <li class="flex items-start text-sm border-b border-blue-100 pb-2">
                                    <span class="font-mono font-bold text-aiBlue w-6 flex-shrink-0">#${index + 1}</span>
                                    <div>
                                        <span class="font-bold text-textMain">${item}</span>
                                        ${reason ? `<span class="text-textSub">: ${reason}</span>` : ''}
                                    </div>
                                </li>
                            `;
                        });
                    }
                    console.log('âœ… [åœ–ç‰‡åˆ†æ] Top 10 List å·²å¡«å……ï¼Œå…±', recommendations.length || 0, 'é …');
                }
                
                // Populate extended ideas
                const extendedIdeasEl = document.getElementById('extended-ideas');
                if (!extendedIdeasEl) {
                    console.error('âŒ [åœ–ç‰‡åˆ†æ] æ‰¾ä¸åˆ° extended-ideas å…ƒç´ ');
                } else {
                    extendedIdeasEl.innerText = extendedIdeas || summaryText || 'æš«ç„¡å»¶ä¼¸å»ºè­°';
                    console.log('âœ… [åœ–ç‰‡åˆ†æ] Extended Ideas å·²å¡«å……ï¼Œé•·åº¦:', extendedIdeas.length);
                }
                
                // ç¢ºä¿éš±è—ç©ºç‹€æ…‹å’Œé¡¯ç¤ºçµæœ
                const emptyEl = document.getElementById('shopee-empty');
                const resultsEl = document.getElementById('shopee-results');
                const paidResultsEl = document.getElementById('shopee-paid-results');
                
                console.log('ğŸ” [åœ–ç‰‡åˆ†æ] æª¢æŸ¥ DOM å…ƒç´ :', {
                    hasEmpty: !!emptyEl,
                    hasResults: !!resultsEl,
                    hasPaidResults: !!paidResultsEl
                });
                
                // å¼·åˆ¶éš±è—å…¶ä»–å€åŸŸ
                if (emptyEl) {
                    emptyEl.classList.add('hidden');
                    console.log('âœ… [åœ–ç‰‡åˆ†æ] å·²éš±è—ç©ºç‹€æ…‹');
                }
                if (paidResultsEl) {
                    paidResultsEl.classList.add('hidden');
                    console.log('âœ… [åœ–ç‰‡åˆ†æ] å·²éš±è—ä»˜è²»çµæœå€åŸŸ');
                }
                
                // å¼·åˆ¶é¡¯ç¤ºçµæœå€åŸŸ
                if (!resultsEl) {
                    console.error('âŒ [åœ–ç‰‡åˆ†æ] æ‰¾ä¸åˆ° shopee-results å…ƒç´ ï¼');
                    // å˜—è©¦æŸ¥æ‰¾æ‰€æœ‰å¯èƒ½çš„çµæœå®¹å™¨
                    const allDivs = document.querySelectorAll('[id*="result"], [id*="shopee"]');
                    console.error('ğŸ” æ‰¾åˆ°çš„ç›¸é—œå…ƒç´ :', Array.from(allDivs).map(el => el.id));
                } else {
                    // å¼·åˆ¶ç§»é™¤ hidden é¡ä¸¦ç¢ºä¿é¡¯ç¤º
                    resultsEl.classList.remove('hidden');
                    resultsEl.style.display = 'flex'; // å¼·åˆ¶é¡¯ç¤º
                    resultsEl.style.visibility = 'visible';
                    resultsEl.style.opacity = '1';
                    
                    // æ»¾å‹•åˆ°çµæœå€åŸŸ
                    resultsEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    
                    console.log('âœ… [åœ–ç‰‡åˆ†æ] çµæœå€åŸŸå·²é¡¯ç¤º');
                    console.log('âœ… [åœ–ç‰‡åˆ†æ] resultsEl é¡å:', resultsEl.className);
                    console.log('âœ… [åœ–ç‰‡åˆ†æ] resultsEl æ¨£å¼:', {
                        display: window.getComputedStyle(resultsEl).display,
                        visibility: window.getComputedStyle(resultsEl).visibility,
                        opacity: window.getComputedStyle(resultsEl).opacity
                    });
                }
                
                showToast('åœ–ç‰‡åˆ†æå ±å‘Šå·²æˆåŠŸç”Ÿæˆï¼');
                console.log('âœ… [åœ–ç‰‡åˆ†æ] åˆ†æå®Œæˆä¸¦é¡¯ç¤ºçµæœ');
                
                // å»¶é²æª¢æŸ¥ä¸€æ¬¡ï¼Œç¢ºä¿é¡¯ç¤º
                setTimeout(() => {
                    if (resultsEl && window.getComputedStyle(resultsEl).display === 'none') {
                        console.error('âš ï¸ [åœ–ç‰‡åˆ†æ] çµæœå€åŸŸè¢« CSS éš±è—ï¼Œå¼·åˆ¶é¡¯ç¤º');
                        resultsEl.style.display = 'flex';
                    }
                }, 100);
                
            } catch (error) {
                console.error('âŒ [åœ–ç‰‡åˆ†æ] éŒ¯èª¤:', error);
                console.error('âŒ [åœ–ç‰‡åˆ†æ] å®Œæ•´éŒ¯èª¤ä¿¡æ¯:', {
                    message: error.message,
                    stack: error.stack,
                    error: error
                });
                
                const loadingEl = document.getElementById('shopee-loading');
                const resultsEl = document.getElementById('shopee-results');
                const emptyEl = document.getElementById('shopee-empty');
                
                if (loadingEl) loadingEl.classList.add('hidden');
                if (resultsEl) resultsEl.classList.add('hidden');
                if (emptyEl) emptyEl.classList.remove('hidden');
                
                const errorMsg = error.message || 'æœªçŸ¥éŒ¯èª¤';
                showToast('åœ–ç‰‡åˆ†æå¤±æ•—: ' + errorMsg);
            }
        }

        // Init
        window.onload = function() {
            switchShopeeMode('free'); // Set default mode
        };
    </script>
</body>
</html>
