<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BROTHER G | è¦çš®é¸å“ AI åˆ†æ</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans TC", sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    
    .container {
      max-width: 900px;
      margin: 40px auto;
      background: white;
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    .header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    h1 {
      color: #2d3748;
      font-size: 32px;
      margin-bottom: 10px;
    }
    
    .subtitle {
      color: #718096;
      font-size: 14px;
    }
    
    .badge {
      display: inline-block;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-top: 8px;
    }
    
    .upload-section {
      margin-bottom: 24px;
    }
    
    label {
      display: block;
      font-weight: 600;
      color: #4a5568;
      margin-bottom: 12px;
      font-size: 16px;
    }
    
    input[type="file"] {
      width: 100%;
      padding: 12px;
      border: 2px dashed #cbd5e0;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 14px;
    }
    
    input[type="file"]:hover {
      border-color: #667eea;
      background: #f7fafc;
    }
    
    .preview {
      display: none;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 12px;
      margin-top: 16px;
    }
    
    .preview.show {
      display: grid;
    }
    
    .preview img {
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-radius: 8px;
      border: 2px solid #e2e8f0;
      transition: transform 0.2s;
    }
    
    .preview img:hover {
      transform: scale(1.05);
    }
    
    textarea {
      width: 100%;
      padding: 12px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      font-size: 16px;
      resize: vertical;
      font-family: inherit;
      transition: all 0.3s;
    }
    
    textarea:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    
    button {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      margin-top: 24px;
    }
    
    button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }
    
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }
    
    .result-container {
      margin-top: 32px;
      display: none;
    }
    
    .result-container.show {
      display: block;
    }
    
    .result-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
      padding: 12px 16px;
      background: #f7fafc;
      border-radius: 8px;
    }
    
    .model-badge {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .time-badge {
      color: #718096;
      font-size: 14px;
    }
    
    .result-content {
      background: #f7fafc;
      padding: 24px;
      border-radius: 12px;
      line-height: 1.8;
      color: #2d3748;
      white-space: pre-wrap;
      max-height: 600px;
      overflow-y: auto;
    }
    
    .loading {
      text-align: center;
      padding: 40px;
      color: #667eea;
      font-size: 18px;
    }
    
    .error {
      background: #fff5f5;
      color: #c53030;
      padding: 16px;
      border-radius: 12px;
      border-left: 4px solid #fc8181;
      margin-top: 16px;
    }
    
    .info {
      background: #ebf8ff;
      color: #2c5282;
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 14px;
      margin-top: 16px;
      border-left: 4px solid #4299e1;
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    
    .loading-animation {
      animation: pulse 1.5s ease-in-out infinite;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>ğŸ¯ BROTHER G è¦çš®é¸å“ AI</h1>
      <p class="subtitle">å°ˆæ¥­çš„é¸å“æ•¸æ“šåˆ†æåŠ©æ‰‹</p>
      <span class="badge">Powered by Gemini 3.0 Pro (å…©æ®µå¼åˆ†æ)</span>
    </div>

    <div class="upload-section">
      <label for="imageInput">ğŸ“· ä¸Šå‚³è¦çš®å¾Œå°æˆªåœ–ï¼ˆæœ€å¤š6å¼µï¼‰</label>
      <input type="file" id="imageInput" multiple accept="image/*" max="6">
      <div id="preview" class="preview"></div>
      <div class="info">
        ğŸ’¡ æ”¯æ´ JPGã€PNGã€WEBP æ ¼å¼ï¼Œå»ºè­°æ¯å¼µåœ–ç‰‡å°æ–¼ 5MB
      </div>
    </div>

    <div class="upload-section">
      <label for="prompt">ğŸ’¬ åˆ†æéœ€æ±‚ï¼ˆå¯é¸ï¼‰</label>
      <textarea 
        id="prompt" 
        rows="3" 
        placeholder="ä¾‹å¦‚ï¼šè«‹åˆ†æé€™äº›å•†å“çš„éŠ·å”®æ•¸æ“šï¼Œä¸¦çµ¦å‡ºé¸å“å»ºè­°å’Œå„ªåŒ–æ–¹å‘"
      ></textarea>
    </div>

    <button id="analyzeBtn">
      <span id="btnText">ğŸš€ é–‹å§‹ AI æ™ºèƒ½åˆ†æ</span>
      <span id="btnLoading" class="loading-animation" style="display:none;">â³ åˆ†æä¸­...</span>
    </button>

    <div id="resultContainer" class="result-container">
      <div class="result-header">
        <div class="model-badge" id="modelBadge">Gemini 3.0 Pro</div>
        <div class="time-badge" id="timeBadge">â±ï¸ --</div>
      </div>
      <div class="result-content" id="resultContent"></div>
    </div>
  </div>

  <script>
    const imageInput = document.getElementById('imageInput');
    const preview = document.getElementById('preview');
    const analyzeBtn = document.getElementById('analyzeBtn');
    const btnText = document.getElementById('btnText');
    const btnLoading = document.getElementById('btnLoading');
    const resultContainer = document.getElementById('resultContainer');
    const resultContent = document.getElementById('resultContent');
    const modelBadge = document.getElementById('modelBadge');
    const timeBadge = document.getElementById('timeBadge');
    const promptInput = document.getElementById('prompt');

    // åœ–ç‰‡é è¦½
    imageInput.addEventListener('change', function() {
      preview.innerHTML = '';
      const files = Array.from(this.files).slice(0, 6);
      
      if (files.length > 0) {
        preview.classList.add('show');
        files.forEach(file => {
          const img = document.createElement('img');
          img.src = URL.createObjectURL(file);
          img.alt = file.name;
          preview.appendChild(img);
        });
      } else {
        preview.classList.remove('show');
      }
    });

    // è½‰æ›ç‚º Base64
    function toBase64(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = reject;
        reader.readAsDataURL(file);
      });
    }

    // åˆ†ææŒ‰éˆ•
    analyzeBtn.addEventListener('click', async function() {
      const files = Array.from(imageInput.files).slice(0, 6);
      
      if (files.length === 0) {
        resultContainer.classList.add('show');
        resultContent.className = 'error';
        resultContent.textContent = 'âŒ è«‹å…ˆä¸Šå‚³è‡³å°‘ 1 å¼µåœ–ç‰‡';
        return;
      }

      // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
      analyzeBtn.disabled = true;
      btnText.style.display = 'none';
      btnLoading.style.display = 'inline';
      
      resultContainer.classList.add('show');
      resultContent.className = 'loading';
      resultContent.innerHTML = 'ğŸ”„ AI æ­£åœ¨é€²è¡Œå…©æ®µå¼åˆ†æ...<br><br>éšæ®µ1: å¿«é€Ÿè®€å–åœ–ç‰‡æ•¸æ“š<br>éšæ®µ2: æ·±åº¦åˆ†æé¸å“ç­–ç•¥<br><br>é è¨ˆ 8-15 ç§’ï¼Œè«‹ç¨å€™...';

      try {
        // è½‰æ›åœ–ç‰‡ç‚º Base64
        const images = await Promise.all(files.map(file => toBase64(file)));

        const prompt = promptInput.value || 'è«‹åˆ†æé€™äº›è¦çš®æ•¸æ“šï¼Œä¸¦çµ¦å‡ºå°ˆæ¥­çš„é¸å“å»ºè­°';

        // å‘¼å« API
        const response = await fetch('/.netlify/functions/analyze', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            images: images,
            prompt: prompt,
            systemPrompt: 'ä½ æ˜¯å°ˆæ¥­çš„è¦çš®é¸å“é¡§å•ï¼Œæ“…é•·æ•¸æ“šåˆ†æå’Œé¸å“ç­–ç•¥ã€‚'
          })
        });

        const data = await response.json();

        if (data.ok) {
          // é¡¯ç¤ºæˆåŠŸçµæœ
          modelBadge.textContent = data.debug.model;
          timeBadge.textContent = `â±ï¸ ${data.debug.time}`;
          
          resultContent.className = 'result-content';
          resultContent.textContent = data.result;
        } else {
          throw new Error(data.error || 'åˆ†æå¤±æ•—');
        }

      } catch (error) {
        console.error('Error:', error);
        resultContent.className = 'error';
        resultContent.textContent = 'âŒ åˆ†æå¤±æ•—ï¼š' + error.message;
      } finally {
        // æ¢å¾©æŒ‰éˆ•ç‹€æ…‹
        analyzeBtn.disabled = false;
        btnText.style.display = 'inline';
        btnLoading.style.display = 'none';
      }
    });
  </script>
</body>
</html>
