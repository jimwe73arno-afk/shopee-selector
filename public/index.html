<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopee Analyst | BrotherG AI</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;800&family=JetBrains+Mono:wght@400;500;700&family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        display: ['Rajdhani', 'sans-serif'],
                        mono: ['JetBrains Mono', 'monospace'],
                    },
                    colors: {
                        aiBlue: '#00A0E9',
                        panel: '#F8FAFC',
                        border: '#E2E8F0',
                        textMain: '#0F172A',
                        textSub: '#64748B',
                        gold: '#D97706',
                    },
                    boxShadow: {
                        'neon': '0 0 15px rgba(0, 160, 233, 0.2)',
                        'card': '0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03)',
                        'card-hover': '0 20px 25px -5px rgba(0, 0, 0, 0.05), 0 10px 10px -5px rgba(0, 0, 0, 0.02)',
                        'glow-pro': '0 0 25px rgba(0, 160, 233, 0.25)',
                        'glow-master': '0 0 25px rgba(217, 119, 6, 0.25)',
                    },
                    animation: {
                        'shockwave': 'shockwave 0.6s ease-out',
                    },
                    keyframes: {
                        shockwave: {
                            '0%': { transform: 'translate(-50%, -50%) scale(0)', opacity: '0.5' },
                            '100%': { transform: 'translate(-50%, -50%) scale(3)', opacity: '0' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #FFFFFF; color: #0F172A; overflow: hidden; }
        
        /* Scrollbar */
        ::-webkit-scrollbar { width: 4px; background: #FFF; }
        ::-webkit-scrollbar-thumb { background: #E2E8F0; border-radius: 2px; }
        ::-webkit-scrollbar-thumb:hover { background: #00A0E9; }

        /* Pure Background */
        .cosmos-bg {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: 
                radial-gradient(circle at 10% 10%, rgba(0, 160, 233, 0.03) 0%, transparent 40%),
                radial-gradient(circle at 90% 90%, rgba(0, 160, 233, 0.03) 0%, transparent 40%);
            z-index: -1;
            pointer-events: none;
        }

        /* Core Card Design */
        .core-card {
            background: #FFFFFF;
            border: 1px solid #E2E8F0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        /* Inputs */
        .cyber-input {
            background: #FFFFFF;
            border: 1px solid #E2E8F0;
            color: #0F172A;
            font-family: 'Inter', sans-serif;
            font-weight: 500;
        }
        .cyber-input:focus {
            border-color: #00A0E9;
            box-shadow: 0 0 0 4px rgba(0, 160, 233, 0.1);
            outline: none;
        }

        /* Custom file input style */
        .custom-file-upload {
            border: 2px dashed #CBD5E1;
            background-color: #F8FAFC;
            transition: all 0.3s;
        }
        .custom-file-upload:hover {
            border-color: #00A0E9;
            background-color: #F0F9FF;
        }

        /* Pricing Card Check/Cross */
        .feature-check { color: #00A0E9; margin-right: 0.5rem; }
        .feature-cross { color: #94A3B8; margin-right: 0.5rem; opacity: 0.5; }
        
        /* Plan Selection Transitions */
        .plan-card {
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            cursor: pointer;
        }
    </style>
</head>
<body class="h-screen flex overflow-hidden selection:bg-aiBlue selection:text-white">

    <div class="cosmos-bg"></div>

    <!-- Main View -->
    <main class="flex-1 relative overflow-hidden flex flex-col">
        
        <!-- Top HUD -->
        <header class="h-16 px-8 flex justify-between items-center z-20 border-b border-border bg-white/80 backdrop-blur-md">
            <div class="flex items-center space-x-4">
                <div class="h-2 w-2 bg-aiBlue rotate-45"></div>
                <span class="text-textMain font-display text-xl tracking-[0.1em] font-bold">BROTHER<span class="text-aiBlue">GAi</span></span>
            </div>
            <div class="flex items-center space-x-8 text-xs font-mono text-textSub">
                <div class="flex items-center space-x-2">
                    <span class="text-aiBlue animate-pulse">●</span>
                    <span>SYSTEM READY</span>
                </div>
                <div class="border border-border px-3 py-1 rounded text-aiBlue bg-blue-50 font-bold">Shopee Analyst</div>
            </div>
        </header>

        <!-- Viewport -->
        <div class="flex-1 overflow-y-auto scroll-smooth p-8 md:p-16 flex flex-col">
            <!-- === SHOPEE INTERFACE === -->
            <div class="h-full flex flex-col max-w-7xl mx-auto w-full">
                <!-- Nav Bar -->
                <div class="flex items-center space-x-4 mb-10">
                    <button onclick="window.location.href='https://brotherg.ai'" class="w-10 h-10 border border-gray-300 flex items-center justify-center text-textSub hover:bg-blue-50 hover:text-aiBlue hover:border-aiBlue transition-all bg-white shadow-sm rounded-lg">
                        <i class="fa-solid fa-angle-left"></i>
                    </button>
                    <div class="h-px flex-1 bg-gradient-to-r from-aiBlue/50 to-transparent"></div>
                    <div class="font-mono text-xs text-aiBlue tracking-widest shadow-sm px-3 py-1 border border-aiBlue rounded bg-blue-50 font-bold">SHOPEE ANALYST</div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 h-full">
                    <!-- Left Control (Input and Mode Selection) -->
                    <div class="lg:col-span-4 space-y-6">
                        
                        <!-- Mode Tabs (Free / Paid) -->
                        <div class="flex border-b border-border bg-white rounded-t-xl overflow-hidden shadow-card">
                            <button id="tab-free" onclick="switchShopeeMode('free')" class="flex-1 py-3 text-sm font-bold transition-all border-b-2" data-mode="free">
                                <span class="text-aiBlue">免費版</span> <span class="text-xs text-textSub">(文字)</span>
                            </button>
                            <button id="tab-paid" onclick="switchShopeeMode('paid')" class="flex-1 py-3 text-sm font-bold transition-all border-b-2" data-mode="paid">
                                <span class="text-textSub">付費版</span> <span class="text-xs text-textSub">(報表圖)</span>
                            </button>
                        </div>
                        
                        <!-- Input Card -->
                        <div class="core-card flex-col p-6 h-auto rounded-b-xl" style="display: flex; flex-direction: column;">
                            
                            <!-- === Free Mode Content === -->
                            <div id="shopee-input-free">
                                <div>
                                    <label class="text-xs font-bold text-aiBlue mb-2 block tracking-widest">WHAT ARE YOU SELLING? (請提供細節)</label>
                                    <textarea id="shopee-keyword" rows="5" placeholder="例如：我在蝦皮賣 eSIM、小米手機、Dyson，幫我看接下來要主推什麼。 (單價、毛利、銷量等資訊越詳細，建議越精準)" 
                                        class="w-full cyber-input p-4 text-base rounded-lg placeholder-gray-400 resize-none border-l-4 border-l-aiBlue"></textarea>
                                    
                                    <button onclick="runShopeeAnalysis()" class="w-full mt-4 bg-textMain text-white font-display font-bold py-4 hover:bg-aiBlue transition-all duration-300 tracking-widest uppercase text-lg relative overflow-hidden shadow-lg rounded-lg">
                                        開始分析市場
                                    </button>
                                </div>
                            </div>
                            
                            <!-- === Paid Mode Content === -->
                            <div id="shopee-input-paid" class="hidden">
                                
                                <div class="opacity-40 pointer-events-none mb-4">
                                    <div class="flex justify-between items-center mb-4">
                                        <label class="text-xs font-bold text-textSub mb-1 block tracking-widest">UPLOAD REPORTS (MAX 10)</label>
                                        <span class="font-mono text-[10px] text-red-500 border border-red-200 px-2 py-0.5 rounded bg-red-50 font-bold">PRO REQUIRED</span>
                                    </div>
                                    
                                    <label for="shopee-image-upload" class="custom-file-upload p-6 flex flex-col items-center justify-center h-32 cursor-pointer rounded-lg mb-4">
                                        <i class="fa-solid fa-cloud-arrow-up text-3xl text-textSub mb-2"></i>
                                        <span class="text-sm font-medium text-textSub">點擊上傳 Shopee 報表截圖</span>
                                        <span class="text-xs text-gray-400 font-mono">最多 10 張 (GMV, 廣告, 商品列表...)</span>
                                        <input type="file" id="shopee-image-upload" multiple accept="image/*" class="hidden">
                                    </label>

                                    <label class="text-xs font-bold text-textSub mb-2 block tracking-widest">YOUR QUERY</label>
                                    <textarea rows="2" placeholder="例如：看完圖，接下來 7 天我該怎麼選品？" 
                                        class="w-full cyber-input p-3 text-base rounded-lg placeholder-gray-400 resize-none border-l-4 border-l-textSub"></textarea>
                                </div>

                                <button onclick="showToast('請於右側選擇方案進行升級')" class="w-full mt-4 bg-gray-300 text-white font-display font-bold py-4 tracking-widest uppercase text-lg relative rounded-lg flex justify-center items-center gap-2 cursor-not-allowed">
                                    <i class="fa-solid fa-crown text-gray-100"></i> 請選擇方案
                                </button>
                                <p class="text-[10px] text-textSub mt-2 text-center font-mono">
                                    (請於右側選擇方案)
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Right Data Vis (Dynamic Content) -->
                    <div class="lg:col-span-8 core-card flex-col p-8 relative rounded-xl overflow-y-auto" style="display: flex; flex-direction: column;">
                        
                        <!-- Loading -->
                        <div id="shopee-loading" class="hidden absolute inset-0 bg-white/90 z-20 flex flex-col items-center justify-center rounded-xl">
                            <div class="w-32 h-32 border-t-4 border-b-4 border-aiBlue rounded-full animate-spin mb-8 shadow-neon"></div>
                            <div class="text-4xl font-display font-bold text-textMain tracking-widest animate-pulse">ANALYZING</div>
                            <div class="text-xs font-mono text-aiBlue mt-4 border border-aiBlue px-4 py-1 font-bold rounded-full">FETCHING MARKET DATA</div>
                        </div>

                        <!-- Empty State -->
                        <div id="shopee-empty" class="flex-1 flex flex-col items-center justify-center opacity-40">
                            <i class="fa-solid fa-magnifying-glass-chart text-8xl mb-8 text-aiBlue animate-pulse"></i>
                            <p class="font-mono text-sm tracking-[0.3em] text-textSub font-bold">等待選品輸入</p>
                        </div>

                        <!-- Results (Free Version) -->
                        <div id="shopee-results" class="hidden h-full flex flex-col w-full">
                            
                            <!-- Header -->
                            <div class="mb-8 border-b border-gray-200 pb-4">
                                <h3 class="text-xl font-display font-bold text-textMain">選品決策卡</h3>
                                <p class="text-sm text-textSub">基於您的文字描述，以下是系統建議。</p>
                            </div>

                            <!-- Top 10 Core Recommendations -->
                            <div class="mb-8 p-6 bg-blue-50 border border-aiBlue/30 rounded-lg">
                                <p class="text-[10px] text-aiBlue font-bold uppercase mb-4 tracking-widest flex items-center">
                                    <i class="fa-solid fa-star-of-life mr-2"></i> TOP 10 主推方向 (核心建議)
                                </p>
                                <ul id="top-10-list" class="space-y-3">
                                    <!-- List items populated by JS -->
                                </ul>
                            </div>

                            <!-- Extended Ideas -->
                            <div class="mb-8 p-6 bg-panel border border-border rounded-lg">
                                <p class="text-[10px] text-textSub font-bold uppercase mb-4 tracking-widest flex items-center">
                                    <i class="fa-solid fa-atom mr-2"></i> 延伸測試組合/類別
                                </p>
                                <p id="extended-ideas" class="text-sm text-textSub leading-relaxed">
                                    <!-- Populated by API response -->
                                </p>
                            </div>
                        </div>
                        
                        <!-- Pricing Table (Paid Mode) -->
                        <div id="shopee-paid-results" class="hidden h-full flex flex-col w-full">
                            <div class="mb-6 flex justify-between items-end border-b border-border pb-4">
                                <div>
                                    <h3 class="text-2xl font-display font-bold text-textMain tracking-wide">CHOOSE YOUR PLAN</h3>
                                    <p class="text-xs font-mono text-textSub mt-1">解鎖 AI 視覺深度診斷與批量分析能力</p>
                                </div>
                                <div class="text-[10px] font-bold bg-blue-50 text-aiBlue px-2 py-1 rounded border border-blue-100">
                                    每月訂閱制
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 flex-1 items-start">
                                
                                <!-- Tier 1: Free -->
                                <div id="plan-card-free" onclick="selectPlan('free')" class="plan-card border border-border rounded-xl p-6 flex flex-col relative bg-white opacity-90">
                                    <h4 class="text-sm font-bold text-textSub uppercase tracking-widest mb-2">體驗版</h4>
                                    <div class="mb-4">
                                        <span class="text-3xl font-display font-bold text-textMain">$0</span>
                                        <span class="text-xs text-textSub">/ month</span>
                                    </div>
                                    <p class="text-xs text-textSub mb-6 h-10">適合剛入門的新手，體驗 AI 威力。</p>
                                    
                                    <ul class="space-y-3 text-xs mb-8 flex-1">
                                        <li class="flex items-center"><i class="fa-solid fa-check feature-check"></i> 每日 5 次 AI 對話</li>
                                        <li class="flex items-center"><i class="fa-solid fa-check feature-check"></i> 單次對話 (無記憶)</li>
                                        <li class="flex items-center text-gray-400"><i class="fa-solid fa-xmark feature-cross"></i> AI 視覺診斷</li>
                                        <li class="flex items-center text-gray-400"><i class="fa-solid fa-xmark feature-cross"></i> 批量分析</li>
                                    </ul>

                                    <button class="w-full py-2 border border-border text-textSub font-bold text-xs rounded pointer-events-none">
                                        目前方案
                                    </button>
                                </div>

                                <!-- Tier 2: PRO -->
                                <div id="plan-card-pro" onclick="selectPlan('pro')" class="plan-card border border-border rounded-xl p-6 flex flex-col relative bg-white opacity-90">
                                    <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-aiBlue text-white text-[10px] font-bold px-3 py-1 rounded-full tracking-wider shadow-sm opacity-0 transition-opacity duration-300" id="badge-pro">
                                        個人賣家首選
                                    </div>
                                    <h4 class="text-sm font-bold text-textSub uppercase tracking-widest mb-2 transition-colors duration-300" id="title-pro">專業版</h4>
                                    <div class="mb-4">
                                        <span class="text-3xl font-display font-bold text-textMain">$688</span>
                                        <span class="text-xs text-textSub">/ month</span>
                                    </div>
                                    <p class="text-xs text-textSub mb-6 h-10">適合全職賣家，深度優化利潤。</p>
                                    
                                    <ul class="space-y-3 text-xs mb-8 flex-1 font-medium">
                                        <li class="flex items-center"><i class="fa-solid fa-check feature-check"></i> 無限次 AI 對話</li>
                                        <li class="flex items-center"><i class="fa-solid fa-check feature-check"></i> 每日 20 次 視覺診斷</li>
                                        <li class="flex items-center"><i class="fa-solid fa-check feature-check"></i> 單張圖片上傳</li>
                                        <li class="flex items-center text-red-400"><i class="fa-solid fa-xmark feature-cross"></i> 無長期記憶 (對話獨立)</li>
                                        <li class="flex items-center"><i class="fa-solid fa-check feature-check"></i> 競品數據分析</li>
                                    </ul>

                                    <button onclick="event.stopPropagation(); goToPaymentPro()" class="w-full py-3 bg-gray-200 text-gray-500 font-bold text-sm rounded shadow-sm hover:bg-aiBlue hover:text-white transition-colors duration-300" id="btn-pro">
                                        立即升級 PRO
                                    </button>
                                </div>

                                <!-- Tier 3: MASTER -->
                                <div id="plan-card-master" onclick="selectPlan('master')" class="plan-card border border-border rounded-xl p-6 flex flex-col relative bg-white opacity-90">
                                    <div class="absolute -top-3 left-1/2 transform -translate-x-1/2 bg-gradient-to-r from-yellow-500 to-amber-600 text-white text-[10px] font-bold px-3 py-1 rounded-full tracking-wider shadow-sm opacity-0 transition-opacity duration-300" id="badge-master">
                                        工作室/企業專用
                                    </div>
                                    <h4 class="text-sm font-bold text-textSub uppercase tracking-widest mb-2 transition-colors duration-300" id="title-master">大師版</h4>
                                    <div class="mb-4">
                                        <span class="text-3xl font-display font-bold text-textMain">$1,688</span>
                                        <span class="text-xs text-textSub">/ month</span>
                                    </div>
                                    <p class="text-xs text-textSub mb-6 h-10">適合工作室與多平台經營者，極致效率。</p>
                                    
                                    <ul class="space-y-3 text-xs mb-8 flex-1">
                                        <li class="flex items-center"><i class="fa-solid fa-check text-amber-500 mr-2"></i> 無限次 AI 對話</li>
                                        <li class="flex items-center"><i class="fa-solid fa-check text-amber-500 mr-2"></i> 每日 50 次 視覺診斷</li>
                                        <li class="flex items-center"><i class="fa-solid fa-fire text-amber-500 mr-2"></i> 批量上傳 (一次 10 張)</li>
                                        <li class="flex items-center"><i class="fa-solid fa-brain text-amber-500 mr-2"></i> AI 長期記憶 (店鋪語境)</li>
                                        <li class="flex items-center"><i class="fa-solid fa-bolt text-amber-500 mr-2"></i> 優先算力通道</li>
                                    </ul>

                                    <button onclick="event.stopPropagation(); goToPaymentMaster()" class="w-full py-2 border border-border text-textSub font-bold text-xs rounded hover:bg-amber-50 hover:text-amber-600 hover:border-amber-500 transition-colors duration-300" id="btn-master">
                                        成為大師
                                    </button>
                                </div>

                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Toast Notification -->
    <div id="toast" class="fixed bottom-8 right-8 bg-textMain text-white px-6 py-3 rounded-lg shadow-xl transform translate-y-24 opacity-0 transition-all duration-300 z-50 flex items-center gap-3">
        <i class="fa-solid fa-info-circle text-aiBlue"></i>
        <span id="toast-msg" class="font-medium text-sm">Notification</span>
    </div>

    <script>
        // State for Shopee Mode
        let shopeeMode = 'free';
        let currentPlan = null;

        // --- Toast Logic ---
        function showToast(msg) {
            const toast = document.getElementById('toast');
            document.getElementById('toast-msg').innerText = msg;
            toast.classList.remove('translate-y-24', 'opacity-0');
            setTimeout(() => {
                toast.classList.add('translate-y-24', 'opacity-0');
            }, 3000);
        }
        
        // --- Shopee Mode Switch Logic ---
        function switchShopeeMode(mode) {
            shopeeMode = mode;
            const tabFree = document.getElementById('tab-free');
            const tabPaid = document.getElementById('tab-paid');
            const inputFree = document.getElementById('shopee-input-free');
            const inputPaid = document.getElementById('shopee-input-paid');
            const resultsDiv = document.getElementById('shopee-results');
            const paidResultsDiv = document.getElementById('shopee-paid-results');
            
            if (mode === 'free') {
                tabFree.classList.add('border-aiBlue', 'text-aiBlue');
                tabPaid.classList.remove('border-aiBlue', 'text-aiBlue');
                tabPaid.classList.add('border-transparent');

                inputFree.classList.remove('hidden');
                inputPaid.classList.add('hidden');

                resultsDiv.classList.remove('hidden');
                paidResultsDiv.classList.add('hidden');
                
                // Reset result view to empty state
                document.getElementById('shopee-results').classList.add('hidden');
                document.getElementById('shopee-empty').classList.remove('hidden');

                showToast('已切換至免費版 (文字分析)');

            } else { // paid
                tabPaid.classList.add('border-aiBlue', 'text-aiBlue');
                tabFree.classList.remove('border-aiBlue', 'text-aiBlue');
                tabFree.classList.add('border-transparent');

                inputPaid.classList.remove('hidden');
                inputFree.classList.add('hidden');

                resultsDiv.classList.add('hidden');
                paidResultsDiv.classList.remove('hidden');

                document.getElementById('shopee-empty').classList.add('hidden');
                
                // Reset Plans on Switch
                resetPlans();
                
                showToast('付費版：請選擇適合您的方案');
            }
        }
        
        // --- Plan Selection Logic ---
        function resetPlans() {
            currentPlan = null;
            const plans = ['free', 'pro', 'master'];
            
            plans.forEach(plan => {
                const card = document.getElementById(`plan-card-${plan}`);
                
                // Reset Base Styles
                card.classList.remove('scale-105', 'z-10', 'opacity-100', 'border-aiBlue', 'shadow-glow-pro', 'border-yellow-500', 'shadow-glow-master');
                card.classList.add('scale-100', 'z-0', 'opacity-90', 'border-border');
                
                // Reset Text Colors
                if(plan === 'pro') {
                    document.getElementById('title-pro').classList.remove('text-aiBlue');
                    document.getElementById('title-pro').classList.add('text-textSub');
                    document.getElementById('badge-pro').classList.remove('opacity-100');
                    document.getElementById('badge-pro').classList.add('opacity-0');
                    
                    const btn = document.getElementById('btn-pro');
                    btn.classList.remove('bg-aiBlue', 'text-white');
                    btn.classList.add('bg-gray-200', 'text-gray-500');
                }
                
                if(plan === 'master') {
                    document.getElementById('title-master').classList.remove('text-amber-600');
                    document.getElementById('title-master').classList.add('text-textSub');
                    document.getElementById('badge-master').classList.remove('opacity-100');
                    document.getElementById('badge-master').classList.add('opacity-0');
                    
                    const btn = document.getElementById('btn-master');
                    btn.classList.remove('border-amber-500', 'text-amber-600');
                    btn.classList.add('border-border', 'text-textSub');
                }
            });
        }

        function selectPlan(plan) {
            if (currentPlan === plan) return;
            
            resetPlans();
            currentPlan = plan;
            
            const card = document.getElementById(`plan-card-${plan}`);
            
            // Apply Active Styles
            card.classList.remove('scale-100', 'z-0', 'opacity-90', 'border-border');
            card.classList.add('scale-105', 'z-10', 'opacity-100');
            
            if (plan === 'free') {
                 card.classList.add('border-gray-400', 'shadow-lg');
            } else if (plan === 'pro') {
                card.classList.add('border-aiBlue', 'shadow-glow-pro');
                
                document.getElementById('title-pro').classList.remove('text-textSub');
                document.getElementById('title-pro').classList.add('text-aiBlue');
                document.getElementById('badge-pro').classList.remove('opacity-0');
                document.getElementById('badge-pro').classList.add('opacity-100');
                
                const btn = document.getElementById('btn-pro');
                btn.classList.remove('bg-gray-200', 'text-gray-500');
                btn.classList.add('bg-aiBlue', 'text-white');
            } else if (plan === 'master') {
                card.classList.add('border-yellow-500', 'shadow-glow-master');
                
                document.getElementById('title-master').classList.remove('text-textSub');
                document.getElementById('title-master').classList.add('text-amber-600');
                document.getElementById('badge-master').classList.remove('opacity-0');
                document.getElementById('badge-master').classList.add('opacity-100');
                
                const btn = document.getElementById('btn-master');
                btn.classList.remove('border-border', 'text-textSub');
                btn.classList.add('border-amber-500', 'text-amber-600');
            }
        }

        // --- Payment Logic ---
        async function goToPaymentPro() {
            showToast('正在準備 PRO 方案付款...');
            
            try {
                // 獲取用戶 ID（如果有登入系統，這裡應該從 localStorage 或 cookie 取得）
                const userId = localStorage.getItem('userId') || 'anonymous';
                
                // 調用支付 API
                const response = await fetch('/.netlify/functions/payment-checkout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        plan: 'PRO',
                        userId: userId,
                    }),
                });

                if (!response.ok) {
                    throw new Error('付款請求失敗');
                }

                // 取得付款表單 HTML，並在當前視窗打開
                const html = await response.text();
                const newWindow = window.open('', '_blank');
                newWindow.document.write(html);
                newWindow.document.close();
                
            } catch (error) {
                console.error('付款錯誤:', error);
                showToast('付款請求失敗，請稍後再試');
            }
        }

        async function goToPaymentMaster() {
            showToast('正在準備大師版付款...');
            
            try {
                // 獲取用戶 ID（如果有登入系統，這裡應該從 localStorage 或 cookie 取得）
                const userId = localStorage.getItem('userId') || 'anonymous';
                
                // 調用支付 API
                const response = await fetch('/.netlify/functions/payment-checkout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        plan: 'MASTER',
                        userId: userId,
                    }),
                });

                if (!response.ok) {
                    throw new Error('付款請求失敗');
                }

                // 取得付款表單 HTML，並在當前視窗打開
                const html = await response.text();
                const newWindow = window.open('', '_blank');
                newWindow.document.write(html);
                newWindow.document.close();
                
            } catch (error) {
                console.error('付款錯誤:', error);
                showToast('付款請求失敗，請稍後再試');
            }
        }

        // --- Shopee Analysis API Call ---
        async function runShopeeAnalysis() {
            if (shopeeMode !== 'free') return showToast('請切換至免費版使用文字分析');
            
            const keyword = document.getElementById('shopee-keyword').value;
            if(!keyword.trim()) return showToast('請輸入您的產品清單或需求');

            // Show loading
            document.getElementById('shopee-empty').classList.add('hidden');
            document.getElementById('shopee-results').classList.add('hidden');
            document.getElementById('shopee-loading').classList.remove('hidden');

            showToast('開始進行選品分析...');

            try {
                // Call backend API
                const response = await fetch('/.netlify/functions/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        textPrompt: keyword,
                        images: []
                    })
                });

                if (!response.ok) {
                    throw new Error(`API 錯誤: ${response.status}`);
                }

                const data = await response.json();

                if (!data.ok) {
                    throw new Error(data.error || '分析失敗');
                }

                // Hide loading
                document.getElementById('shopee-loading').classList.add('hidden');

                // Parse and display results
                let recommendations = [];
                let extendedIdeas = '';

                if (data.recommendations && Array.isArray(data.recommendations)) {
                    recommendations = data.recommendations;
                } else if (data.summary) {
                    // Fallback: try to parse recommendations from summary
                    recommendations = [{ item: "分析結果", reason: data.summary }];
                }

                if (data.plan) {
                    extendedIdeas = data.plan;
                } else if (data.summary) {
                    extendedIdeas = data.summary;
                }

                // Populate Top 10 List
                const top10List = document.getElementById('top-10-list');
                top10List.innerHTML = '';
                
                recommendations.slice(0, 10).forEach((rec, index) => {
                    const item = typeof rec === 'string' ? rec : rec.item || rec;
                    const reason = typeof rec === 'string' ? '' : rec.reason || '';
                    
                    top10List.innerHTML += `
                        <li class="flex items-start text-sm border-b border-blue-100 pb-2">
                            <span class="font-mono font-bold text-aiBlue w-6 flex-shrink-0">#${index + 1}</span>
                            <div>
                                <span class="font-bold text-textMain">${item}</span>
                                ${reason ? `<span class="text-textSub">: ${reason}</span>` : ''}
                            </div>
                        </li>
                    `;
                });

                // Populate extended ideas
                document.getElementById('extended-ideas').innerText = extendedIdeas || '暫無延伸建議';

                // Show results
                document.getElementById('shopee-results').classList.remove('hidden');
                document.getElementById('shopee-keyword').value = '';
                
                showToast('選品決策卡已成功生成！');

            } catch (error) {
                console.error('分析錯誤:', error);
                document.getElementById('shopee-loading').classList.add('hidden');
                document.getElementById('shopee-empty').classList.remove('hidden');
                showToast('分析失敗: ' + error.message);
            }
        }

        // Init
        window.onload = function() {
            switchShopeeMode('free'); // Set default mode
        };
    </script>
</body>
</html>
