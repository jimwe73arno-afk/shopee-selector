<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»˜æ¬¾æˆåŠŸ | BrotherGAi</title>
    <link rel="icon" type="image/png" href="/logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            background: #f0f;
            animation: confetti-fall 3s ease-out forwards;
        }
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-green-50 to-blue-50 flex items-center justify-center p-6">
    
    <div class="max-w-md w-full text-center">
        <!-- Success Icon -->
        <div class="w-24 h-24 mx-auto mb-6 rounded-full bg-green-100 border-4 border-green-500 flex items-center justify-center animate-bounce">
            <i class="fa-solid fa-check text-4xl text-green-500"></i>
        </div>

        <!-- Title -->
        <h1 class="text-3xl font-bold text-gray-900 mb-3">
            ğŸ‰ ä»˜æ¬¾æˆåŠŸï¼
        </h1>
        
        <!-- Message -->
        <p class="text-gray-600 mb-6" id="success-message">
            æ„Ÿè¬ä½ çš„æ”¯æŒï¼ä½ çš„ Pro æœƒå“¡å·²ç¶“å•Ÿç”¨ã€‚
        </p>
        
        <!-- Order Info -->
        <div class="bg-white rounded-xl p-4 mb-6 border border-gray-200 shadow-sm">
            <div class="text-sm text-gray-500 mb-1">è¨‚å–®ç·¨è™Ÿ</div>
            <div class="font-mono text-lg text-gray-900" id="order-id">-</div>
        </div>
        
        <!-- CTA -->
        <a id="return-btn" href="/" class="block w-full py-4 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-bold rounded-xl hover:from-blue-600 hover:to-blue-700 transition-all shadow-lg">
            <i class="fa-solid fa-arrow-left mr-2"></i>è¿”å›ç¹¼çºŒä½¿ç”¨
        </a>
        
        <p class="text-xs text-gray-400 mt-4">
            å¦‚æœ‰ä»»ä½•å•é¡Œï¼Œè«‹è¯ç¹«å®¢æœ
        </p>
    </div>

    <script>
        // ç²å– URL åƒæ•¸
        const params = new URLSearchParams(window.location.search);
        const product = params.get('product');
        const token = params.get('token');
        const payerId = params.get('PayerID');

        // è¨­å®šè¨‚å–®ç·¨è™Ÿ
        if (token) {
            document.getElementById('order-id').textContent = token;
        }

        // å–å¾— sessionIdï¼ˆå¦‚æœæœ‰ï¼‰
        const sessionId = params.get('sessionId');
        const returnPath = params.get('return') || '/';

        // æ ¹æ“šç”¢å“é¡å‹è¨­å®šè¨Šæ¯å’Œè¿”å›é€£çµ
        const productConfig = {
            'BROTHERG_PRO': {
                message: 'ğŸ‰ ä»˜æ¬¾æˆåŠŸï¼æ­£åœ¨ç”Ÿæˆä½ çš„ Tesla æ±ºç­–å¡...',
                returnUrl: sessionId ? `/tesla-app?sessionId=${sessionId}&paid=true` : '/tesla-app',
                returnText: 'æŸ¥çœ‹æ±ºç­–å¡'
            },
            'TESLA_PRO': {
                message: 'ğŸ‰ ä»˜æ¬¾æˆåŠŸï¼æ­£åœ¨ç”Ÿæˆä½ çš„ Tesla æ±ºç­–å¡...',
                returnUrl: sessionId ? `/tesla-app?sessionId=${sessionId}&paid=true` : '/tesla-app',
                returnText: 'æŸ¥çœ‹æ±ºç­–å¡'
            },
            'SHOPEE_PRO': {
                message: 'ğŸ‰ æ­å–œæˆç‚º Pro æœƒå“¡ï¼æ¯å¤©å¯å• 30 é¡Œ',
                returnUrl: '/app',
                returnText: 'è¿”å›é¸å“çµäºº'
            },
            'PRO': {
                message: 'ğŸ‰ æ­å–œæˆç‚º Pro æœƒå“¡ï¼æ¯å¤©å¯å• 30 é¡Œ',
                returnUrl: returnPath,
                returnText: 'é–‹å§‹ä½¿ç”¨'
            }
        };

        const config = productConfig[product] || productConfig['BROTHERG_PRO'];
        document.getElementById('success-message').textContent = config.message;
        
        // å¦‚æœæœ‰ sessionIdï¼Œè‡ªå‹•è·³è½‰åˆ° tesla-app é¡¯ç¤ºæ±ºç­–å¡
        if (sessionId && (product === 'BROTHERG_PRO' || product === 'TESLA_PRO')) {
            document.getElementById('return-btn').href = config.returnUrl;
            document.getElementById('return-btn').innerHTML = `<i class="fa-solid fa-arrow-right mr-2"></i>${config.returnText}`;
            // 3 ç§’å¾Œè‡ªå‹•è·³è½‰
            setTimeout(() => {
                window.location.href = config.returnUrl;
            }, 3000);
        } else {
            document.getElementById('return-btn').href = config.returnUrl;
            document.getElementById('return-btn').innerHTML = `<i class="fa-solid fa-arrow-left mr-2"></i>${config.returnText}`;
        }

        // å„²å­˜ä»˜æ¬¾ç‹€æ…‹åˆ° localStorageï¼ˆçµ±ä¸€ä½¿ç”¨ BROTHERG_PRO_paidï¼‰
        localStorage.setItem('BROTHERG_PRO_paid', 'true');
        localStorage.setItem('userTier', 'pro');
        localStorage.setItem('paymentDate', new Date().toISOString());
        
        // å¦‚æœæœ‰ç‰¹å®šç”¢å“ä¹Ÿå­˜ä¸€ä»½
        if (product && product !== 'BROTHERG_PRO') {
            localStorage.setItem(`${product}_paid`, 'true');
        }

        // å‰µå»ºå½©å¸¶æ•ˆæœ
        function createConfetti() {
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD'];
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                document.body.appendChild(confetti);
                
                setTimeout(() => confetti.remove(), 5000);
            }
        }
        createConfetti();
    </script>
</body>
</html>
